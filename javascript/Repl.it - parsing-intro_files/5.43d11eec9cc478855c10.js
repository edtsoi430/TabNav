(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{2570:function(e,t,n){var i=n(69).EventEmitter;t.EventEmitter=i,t.mixin=function(e){for(var t in i.prototype)e.prototype[t]=i.prototype[t]}},2571:function(e,t,n){function i(e,t){i.super.call(this,t),this.code=e}n(2683)(i),e.exports=i},2572:function(e,t,n){t.defaultType=n(2684).type,t.map={},t.register=function(e){e.name&&(t.map[e.name]=e),e.uri&&(t.map[e.uri]=e)},t.register(t.defaultType)},2637:function(e,t,n){(function(t){var i=n(2570),o=n(2571),r=n(2572);function s(e,t,n){i.EventEmitter.call(this),this.connection=e,this.collection=t,this.id=n,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function a(e,t,n){if(t){var i=e.pop();e.push(function(e){i&&i(e),n&&n(e)})}else e.push(n)}function c(e,t){if(e.del)return delete(n=t).op,delete n.create,void delete n.del;var n;if(t.del)return new o(4017,"Document was deleted");if(t.create)return new o(4018,"Document alredy created");if(t.op){if(e.create)return new o(4018,"Document already created");if(e.type.transformX){var i=e.type.transformX(e.op,t.op);e.op=i[0],t.op=i[1]}else{var r=e.type.transform(e.op,t.op,"left"),s=e.type.transform(t.op,e.op,"right");e.op=r,t.op=s}}}function l(e,t){for(var n=!1,i=0;i<e.length;i++){var o=e[i];o&&(o(t),n=!0)}return n}e.exports=s,i.mixin(s),s.prototype.destroy=function(e){var t=this;t.whenNothingPending(function(){if(t.connection._destroyDoc(t),t.wantSubscribe)return t.unsubscribe(e);e&&e()})},s.prototype._setType=function(e){if("string"==typeof e&&(e=r.map[e]),e)this.type=e;else{if(null!==e){var t=new o(4008,"Missing type "+e);return this.emit("error",t)}this.type=e,this.data=void 0}},s.prototype.ingestSnapshot=function(e,t){if(!e)return t&&t();if("number"!=typeof e.v){var n=new o(5008,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return t?t(n):this.emit("error",n)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return t&&this.once("no write pending",t);n=new o(5009,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return t?t(n):this.emit("error",n)}return e.v>this.version?this.fetch(t):t&&t()}if(this.version>e.v)return t&&t();this.version=e.v;var i=void 0===e.type?r.defaultType:e.type;this._setType(i),this.data=this.type&&this.type.deserialize?this.type.deserialize(e.data):e.data,this.emit("load"),t&&t()},s.prototype.whenNothingPending=function(e){this.hasPending()?this.once("nothing pending",e):e()},s.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},s.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},s.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},s.prototype._emitResponseError=function(e,t){if(t)return t(e),void this._emitNothingPending();this._emitNothingPending(),this.emit("error",e)},s.prototype._handleFetch=function(e,t){var n=this.inflightFetch.shift();if(e)return this._emitResponseError(e,n);this.ingestSnapshot(t,n),this._emitNothingPending()},s.prototype._handleSubscribe=function(e,t){var n=this.inflightSubscribe.shift();if(e)return this._emitResponseError(e,n);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(t,n),this._emitNothingPending()},s.prototype._handleUnsubscribe=function(e){var t=this.inflightUnsubscribe.shift();if(e)return this._emitResponseError(e,t);t&&t(),this._emitNothingPending()},s.prototype._handleOp=function(e,t){if(e)return this.inflightOp?(4002===e.code&&(e=null),this._rollback(e)):this.emit("error",e);if(this.inflightOp&&t.src===this.inflightOp.src&&t.seq===this.inflightOp.seq)this._opAcknowledged(t);else if(null==this.version||t.v>this.version)this.fetch();else if(!(t.v<this.version)){if(this.inflightOp)if(i=c(this.inflightOp,t))return this._hardRollback(i);for(var n=0;n<this.pendingOps.length;n++){var i;if(i=c(this.pendingOps[n],t))return this._hardRollback(i)}this.version++,this._otApply(t,!1)}},s.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var e=this.inflightUnsubscribe;this.inflightUnsubscribe=[],l(e)}},s.prototype._resubscribe=function(){var e=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return e.length?void this.subscribe(function(t){l(e,t)}):void this.subscribe();e.length&&this.fetch(function(t){l(e,t)})},s.prototype.fetch=function(e){if(this.connection.canSend){var t=this.connection.sendFetch(this);a(this.inflightFetch,t,e)}else this.pendingFetch.push(e)},s.prototype.subscribe=function(e){if(this.wantSubscribe=!0,this.connection.canSend){var t=this.connection.sendSubscribe(this);a(this.inflightSubscribe,t,e)}else this.pendingFetch.push(e)},s.prototype.unsubscribe=function(e){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var n=this.connection.sendUnsubscribe(this);a(this.inflightUnsubscribe,n,e)}else e&&t.nextTick(e)},s.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},s.prototype._otApply=function(e,t){if(e.op){if(!this.type){var n=new o(4015,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);return this.emit("error",n)}if(!t&&this.type===r.defaultType&&e.op.length>1){this.applyStack||(this.applyStack=[]);for(var i=this.applyStack.length,s=0;s<e.op.length;s++){for(var a={op:[e.op[s]]},l=i;l<this.applyStack.length;l++){var u=c(this.applyStack[l],a);if(u)return this._hardRollback(u)}this.emit("before op",a.op,t),this.data=this.type.apply(this.data,a.op),this.emit("op",a.op,t)}return void this._popApplyStack(i)}return this.emit("before op",e.op,t),this.data=this.type.apply(this.data,e.op),void this.emit("op",e.op,t)}if(e.create)return this._setType(e.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(e.create.data):this.type.deserialize(this.type.create(e.create.data)):this.type.create(e.create.data),void this.emit("create",t);if(e.del){var h=this.data;return this._setType(null),void this.emit("del",h,t)}},s.prototype._sendOp=function(){var e=this.connection.id;if(e){this.inflightOp||(this.inflightOp=this.pendingOps.shift());var t=this.inflightOp;if(!t){var n=new o(5010,"No op to send on call to _sendOp");return this.emit("error",n)}t.sentAt=Date.now(),t.retries=null==t.retries?0:t.retries+1,null==t.seq&&(t.seq=this.connection.seq++),this.connection.sendOp(this,t),null==t.src&&(t.src=e)}},s.prototype._submit=function(e,n,i){if(n||(n=!0),e.op){if(!this.type){var r=new o(4015,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return i?i(r):this.emit("error",r)}this.type.normalize&&(e.op=this.type.normalize(e.op))}this._pushOp(e,i),this._otApply(e,n);var s=this;t.nextTick(function(){s.flush()})},s.prototype._pushOp=function(e,t){if(this.applyStack)this.applyStack.push(e);else{var n=this._tryCompose(e);if(n)return void n.callbacks.push(t)}e.type=this.type,e.callbacks=[t],this.pendingOps.push(e)},s.prototype._popApplyStack=function(e){if(e>0)this.applyStack.length=e;else{var t=this.applyStack[0];if(this.applyStack=null,t)if(-1!==(i=this.pendingOps.indexOf(t)))for(var n=this.pendingOps.splice(i),i=0;i<n.length;i++){t=n[i];var o=this._tryCompose(t);o?o.callbacks=o.callbacks.concat(t.callbacks):this.pendingOps.push(t)}}},s.prototype._tryCompose=function(e){if(!this.preventCompose){var t=this.pendingOps[this.pendingOps.length-1];if(t)return t.create&&e.op?(t.create.data=this.type.apply(t.create.data,e.op),t):t.op&&e.op&&this.type.compose?(t.op=this.type.compose(t.op,e.op),t):void 0}},s.prototype.submitOp=function(e,t,n){"function"==typeof t&&(n=t,t=null);var i={op:e},o=t&&t.source;this._submit(i,o,n)},s.prototype.create=function(e,t,n,i){if("function"==typeof t?(i=t,n=null,t=null):"function"==typeof n&&(i=n,n=null),t||(t=r.defaultType.uri),this.type){var s=new o(4016,"Document already exists");return i?i(s):this.emit("error",s)}var a={create:{type:t,data:e}},c=n&&n.source;this._submit(a,c,i)},s.prototype.del=function(e,t){if("function"==typeof e&&(t=e,e=null),!this.type){var n=new o(4015,"Document does not exist");return t?t(n):this.emit("error",n)}var i=e&&e.source;this._submit({del:!0},i,t)},s.prototype.pause=function(){this.paused=!0},s.prototype.resume=function(){this.paused=!1,this.flush()},s.prototype._opAcknowledged=function(e){if(this.inflightOp.create)this.version=e.v;else if(e.v!==this.version)return console.warn("Invalid version from server. Expected: "+this.version+" Received: "+e.v,e),this.fetch();this.version++,this._clearInflightOp()},s.prototype._rollback=function(e){var t=this.inflightOp;if(t.op&&t.type.invert){t.op=t.type.invert(t.op);for(var n=0;n<this.pendingOps.length;n++){var i=c(this.pendingOps[n],t);if(i)return this._hardRollback(i)}return this._otApply(t,!1),void this._clearInflightOp(e)}this._hardRollback(e)},s.prototype._hardRollback=function(e){var t=this.inflightOp,n=this.pendingOps;this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var i=this;this.fetch(function(){for(var o=t&&l(t.callbacks,e),r=0;r<n.length;r++)l(n[r].callbacks,e);if(e&&!o)return i.emit("error",e)})},s.prototype._clearInflightOp=function(e){var t=l(this.inflightOp.callbacks,e);if(this.inflightOp=null,this.flush(),this._emitNothingPending(),e&&!t)return this.emit("error",e)}}).call(this,n(87))},2638:function(e,t){e.exports=function(e,t,n,i){var o=function(e,n,i,o){t(i,e,n,"left"),t(o,n,e,"right")},r=e.transformX=function(e,t){n(e),n(t);for(var s=[],a=0;a<t.length;a++){for(var c=t[a],l=[],u=0;u<e.length;){var h=[];if(o(e[u],c,l,h),u++,1!==h.length){if(0===h.length){for(var p=u;p<e.length;p++)i(l,e[p]);c=null;break}for(var d=r(e.slice(u),h),f=0;f<d[0].length;f++)i(l,d[0][f]);for(var v=0;v<d[1].length;v++)i(s,d[1][v]);c=null;break}c=h[0]}null!=c&&i(s,c),e=l}return[e,s]};e.transform=function(e,n,i){if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");return 0===n.length?e:1===e.length&&1===n.length?t([],e[0],n[0],i):"left"===i?r(e,n)[0]:r(n,e)[1]}}},2639:function(e,t,n){(function(t){var i=n(2570);function o(e,t,n,o,r,s,a){i.EventEmitter.call(this),this.action=e,this.connection=t,this.id=n,this.collection=o,this.query=r,this.results=null,s&&s.results&&(this.results=s.results,delete s.results),this.extra=void 0,this.options=s,this.callback=a,this.ready=!1,this.sent=!1}e.exports=o,i.mixin(o),o.prototype.hasPending=function(){return!this.ready},o.prototype.send=function(){if(this.connection.canSend){var e={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(e.o=this.options),this.results){for(var t=[],n=0;n<this.results.length;n++){var i=this.results[n];t.push([i.id,i.version])}e.r=t}this.connection.send(e),this.sent=!0}},o.prototype.destroy=function(e){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),e&&t.nextTick(e)},o.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},o.prototype._handleFetch=function(e,t,n){this.connection._destroyQuery(this),this._handleResponse(e,t,n)},o.prototype._handleSubscribe=function(e,t,n){this._handleResponse(e,t,n)},o.prototype._handleResponse=function(e,t,n){var i=this.callback;if(this.callback=null,e)return this._finishResponse(e,i);if(!t)return this._finishResponse(null,i);var o=this,r=1,s=function(e){if(e)return o._finishResponse(e,i);--r||o._finishResponse(null,i)};if(Array.isArray(t))r+=t.length,this.results=this._ingestSnapshots(t,s),this.extra=n;else for(var a in t){r++;var c=t[a];this.connection.get(c.c||this.collection,a).ingestSnapshot(c,s)}s()},o.prototype._ingestSnapshots=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i],r=this.connection.get(o.c||this.collection,o.d);r.ingestSnapshot(o,t),n.push(r)}return n},o.prototype._finishResponse=function(e,t){if(this.emit("ready"),this.ready=!0,e)return this.connection._destroyQuery(this),t?t(e):this.emit("error",e);t&&t(null,this.results,this.extra)},o.prototype._handleError=function(e){this.emit("error",e)},o.prototype._handleDiff=function(e){for(var t=0;t<e.length;t++){"insert"===(n=e[t]).type&&(n.values=this._ingestSnapshots(n.values))}for(t=0;t<e.length;t++){var n;switch((n=e[t]).type){case"insert":var i=n.values;Array.prototype.splice.apply(this.results,[n.index,0].concat(i)),this.emit("insert",i,n.index);break;case"remove":var o=n.howMany||1,r=this.results.splice(n.index,o);this.emit("remove",r,n.index);break;case"move":o=n.howMany||1;var s=this.results.splice(n.from,o);Array.prototype.splice.apply(this.results,[n.to,0].concat(s)),this.emit("move",s,n.from,n.to)}}this.emit("changed",this.results)},o.prototype._handleExtra=function(e){this.extra=e,this.emit("extra",e)}}).call(this,n(87))},2681:function(e,t,n){t.Connection=n(2682),t.Doc=n(2637),t.Error=n(2571),t.Query=n(2639),t.types=n(2572)},2682:function(e,t,n){(function(t){var i=n(2637),o=n(2639),r=n(2570),s=n(2571),a=n(2572),c=n(2687);function l(e){return 0===e.readyState||1===e.readyState?"connecting":"disconnected"}function u(e){r.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.queries={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=l(e),this.bindToSocket(e)}function h(e){return e.hasPending()}function p(e){return e.hasWritePending()}e.exports=u,r.mixin(u),u.prototype.bindToSocket=function(e){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=e;var n=l(e);this._setState(n),this.canSend=!1;var i=this;e.onmessage=function(e){try{var n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){return void console.warn("Failed to parse message",e)}i.debug&&console.log("RECV",JSON.stringify(n));var o={data:n};if(i.emit("receive",o),o.data)try{i.handleMessage(o.data)}catch(e){t.nextTick(function(){i.emit("error",e)})}},e.onopen=function(){i._setState("connecting")},e.onerror=function(e){i.emit("connection error",e)},e.onclose=function(e){"closed"===e||"Closed"===e?i._setState("closed",e):"stopped"===e||"Stopped by server"===e?i._setState("stopped",e):i._setState("disconnected",e)}},u.prototype.handleMessage=function(e){var t=null;switch(e.error&&((t=new Error(e.error.message)).code=e.error.code,t.data=e,delete e.error),e.a){case"init":return 1!==e.protocol?(t=new s(4019,"Invalid protocol version"),this.emit("error",t)):a.map[e.type]!==a.defaultType?(t=new s(4020,"Invalid default type"),this.emit("error",t)):"string"!=typeof e.id?(t=new s(4021,"Invalid client id"),this.emit("error",t)):(this.id=e.id,void this._setState("connected"));case"qf":return void((n=this.queries[e.id])&&n._handleFetch(t,e.data,e.extra));case"qs":return void((n=this.queries[e.id])&&n._handleSubscribe(t,e.data,e.extra));case"qu":return;case"q":var n;if(!(n=this.queries[e.id]))return;return t?n._handleError(t):(e.diff&&n._handleDiff(e.diff),void(e.hasOwnProperty("extra")&&n._handleExtra(e.extra)));case"bf":return this._handleBulkMessage(e,"_handleFetch");case"bs":return this._handleBulkMessage(e,"_handleSubscribe");case"bu":return this._handleBulkMessage(e,"_handleUnsubscribe");case"f":return void((i=this.getExisting(e.c,e.d))&&i._handleFetch(t,e.data));case"s":return void((i=this.getExisting(e.c,e.d))&&i._handleSubscribe(t,e.data));case"u":return void((i=this.getExisting(e.c,e.d))&&i._handleUnsubscribe(t));case"op":var i;return void((i=this.getExisting(e.c,e.d))&&i._handleOp(t,e));default:console.warn("Ignoring unrecognized message",e)}},u.prototype._handleBulkMessage=function(e,t){if(e.data)for(var n in e.data){(o=this.getExisting(e.c,n))&&o[t](e.error,e.data[n])}else if(Array.isArray(e.b))for(var i=0;i<e.b.length;i++){n=e.b[i];(o=this.getExisting(e.c,n))&&o[t](e.error)}else if(e.b)for(var n in e.b){var o;(o=this.getExisting(e.c,n))&&o[t](e.error)}else console.error("Invalid bulk message",e)},u.prototype._reset=function(){this.seq=1,this.id=null,this.agent=null},u.prototype._setState=function(e,t){if(this.state!==e){if("connecting"===e&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===e&&"connecting"!==this.state){var n=new s(5007,"Cannot transition directly from "+this.state+" to "+e);return this.emit("error",n)}for(var i in this.state=e,this.canSend="connected"===e,"disconnected"!==e&&"stopped"!==e&&"closed"!==e||this._reset(),this.startBulk(),this.queries){this.queries[i]._onConnectionStateChanged()}for(var o in this.collections){var r=this.collections[o];for(var i in r)r[i]._onConnectionStateChanged()}this.endBulk(),this.emit(e,t),this.emit("state",e,t)}},u.prototype.startBulk=function(){this.bulk||(this.bulk={})},u.prototype.endBulk=function(){if(this.bulk)for(var e in this.bulk){var t=this.bulk[e];this._sendBulk("f",e,t.f),this._sendBulk("s",e,t.s),this._sendBulk("u",e,t.u)}this.bulk=null},u.prototype._sendBulk=function(e,t,n){if(n){var i,o=[],r={},s=0;for(var a in n){var c=n[a];null==c?o.push(a):(r[a]=c,i=a,s++)}if(1===o.length){a=o[0];this.send({a:e,c:t,d:a})}else o.length&&this.send({a:"b"+e,c:t,b:o});if(1===s){var l=r[i];this.send({a:e,c:t,d:i,v:l})}else s&&this.send({a:"b"+e,c:t,b:r})}},u.prototype._sendAction=function(e,t,n){if(this._addDoc(t),this.bulk){var i=this.bulk[t.collection]||(this.bulk[t.collection]={}),o=i[e]||(i[e]={}),r=o.hasOwnProperty(t.id);return o[t.id]=n,r}var s={a:e,c:t.collection,d:t.id,v:n};this.send(s)},u.prototype.sendFetch=function(e){return this._sendAction("f",e,e.version)},u.prototype.sendSubscribe=function(e){return this._sendAction("s",e,e.version)},u.prototype.sendUnsubscribe=function(e){return this._sendAction("u",e)},u.prototype.sendOp=function(e,t){this._addDoc(e);var n={a:"op",c:e.collection,d:e.id,v:e.version,src:t.src,seq:t.seq};t.op&&(n.op=t.op),t.create&&(n.create=t.create),t.del&&(n.del=t.del),this.send(n)},u.prototype.send=function(e){this.debug&&console.log("SEND",JSON.stringify(e)),this.emit("send",e),this.socket.send(JSON.stringify(e))},u.prototype.close=function(){this.socket.close()},u.prototype.getExisting=function(e,t){if(this.collections[e])return this.collections[e][t]},u.prototype.get=function(e,t){var n=this.collections[e]||(this.collections[e]={}),o=n[t];return o||(o=n[t]=new i(this,e,t),this.emit("doc",o)),o},u.prototype._destroyDoc=function(e){var t=this.collections[e.collection];t&&(delete t[e.id],c.hasKeys(t)||delete this.collections[e.collection])},u.prototype._addDoc=function(e){var t=this.collections[e.collection];t||(t=this.collections[e.collection]={}),t[e.id]!==e&&(t[e.id]=e)},u.prototype._createQuery=function(e,t,n,i,r){var s=this.nextQueryId++,a=new o(e,this,s,t,n,i,r);return this.queries[s]=a,a.send(),a},u.prototype._destroyQuery=function(e){delete this.queries[e.id]},u.prototype.createFetchQuery=function(e,t,n,i){return this._createQuery("qf",e,t,n,i)},u.prototype.createSubscribeQuery=function(e,t,n,i){return this._createQuery("qs",e,t,n,i)},u.prototype.hasPending=function(){return!(!this._firstDoc(h)&&!this._firstQuery(h))},u.prototype.hasWritePending=function(){return!!this._firstDoc(p)},u.prototype.whenNothingPending=function(e){var n=this._firstDoc(h);if(n)n.once("nothing pending",this._nothingPendingRetry(e));else{var i=this._firstQuery(h);i?i.once("ready",this._nothingPendingRetry(e)):t.nextTick(e)}},u.prototype._nothingPendingRetry=function(e){var n=this;return function(){t.nextTick(function(){n.whenNothingPending(e)})}},u.prototype._firstDoc=function(e){for(var t in this.collections){var n=this.collections[t];for(var i in n){var o=n[i];if(e(o))return o}}},u.prototype._firstQuery=function(e){for(var t in this.queries){var n=this.queries[t];if(e(n))return n}}}).call(this,n(87))},2683:function(e,t,n){"use strict";var i="undefined"!=typeof Reflect?Reflect.construct:void 0,o=Object.defineProperty,r=Error.captureStackTrace;function s(e){void 0!==e&&o(this,"message",{configurable:!0,value:e,writable:!0});var t=this.constructor.name;void 0!==t&&t!==this.name&&o(this,"name",{configurable:!0,value:t,writable:!0}),r(this,this.constructor)}void 0===r&&(r=function(e){var t=new Error;o(e,"stack",{configurable:!0,get:function(){var e=t.stack;return o(this,"stack",{configurable:!0,value:e,writable:!0}),e},set:function(t){o(e,"stack",{configurable:!0,value:t,writable:!0})}})}),s.prototype=Object.create(Error.prototype,{constructor:{configurable:!0,value:s,writable:!0}});var a=function(){function e(e,t){return o(e,"name",{configurable:!0,value:t})}try{var t=function(){};if(e(t,"foo"),"foo"===t.name)return e}catch(e){}}();(e.exports=function(e,t){if(null==t||t===Error)t=s;else if("function"!=typeof t)throw new TypeError("super_ should be a function");var n;if("string"==typeof e)n=e,e=void 0!==i?function(){return i(t,arguments,this.constructor)}:function(){t.apply(this,arguments)},void 0!==a&&(a(e,n),n=void 0);else if("function"!=typeof e)throw new TypeError("constructor should be either a string or a function");e.super_=e.super=t;var o={constructor:{configurable:!0,value:e,writable:!0}};return void 0!==n&&(o.name={configurable:!0,value:n,writable:!0}),e.prototype=Object.create(t.prototype,o),e}).BaseError=s},2684:function(e,t,n){e.exports={type:n(2685)}},2685:function(e,t,n){var i=function(e){return"[object Array]"==Object.prototype.toString.call(e)},o=function(e){return JSON.parse(JSON.stringify(e))},r={name:"json0",uri:"http://sharejs.org/types/JSONv0"},s={};function a(e){e.t="text0";var t={p:e.p.pop()};null!=e.si&&(t.i=e.si),null!=e.sd&&(t.d=e.sd),e.o=[t]}function c(e){e.p.push(e.o[0].p),null!=e.o[0].i&&(e.si=e.o[0].i),null!=e.o[0].d&&(e.sd=e.o[0].d),delete e.t,delete e.o}r.registerSubtype=function(e){s[e.name]=e},r.create=function(e){return void 0===e?null:o(e)},r.invertComponent=function(e){var t={p:e.p};return e.t&&s[e.t]&&(t.t=e.t,t.o=s[e.t].invert(e.o)),void 0!==e.si&&(t.sd=e.si),void 0!==e.sd&&(t.si=e.sd),void 0!==e.oi&&(t.od=e.oi),void 0!==e.od&&(t.oi=e.od),void 0!==e.li&&(t.ld=e.li),void 0!==e.ld&&(t.li=e.ld),void 0!==e.na&&(t.na=-e.na),void 0!==e.lm&&(t.lm=e.p[e.p.length-1],t.p=e.p.slice(0,e.p.length-1).concat([e.lm])),t},r.invert=function(e){for(var t=e.slice().reverse(),n=[],i=0;i<t.length;i++)n.push(r.invertComponent(t[i]));return n},r.checkValidOp=function(e){for(var t=0;t<e.length;t++)if(!i(e[t].p))throw new Error("Missing path")},r.checkList=function(e){if(!i(e))throw new Error("Referenced element not a list")},r.checkObj=function(e){if(!(t=e)||t.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(e)+")");var t},r.apply=function(e,t){r.checkValidOp(t),t=o(t);for(var n={data:e},i=0;i<t.length;i++){var c=t[i];null==c.si&&null==c.sd||a(c);for(var l=null,u=n,h="data",p=0;p<c.p.length;p++){var d=c.p[p];if(l=u,h,u=u[h],h=d,null==l)throw new Error("Path invalid")}if(c.t&&void 0!==c.o&&s[c.t])u[h]=s[c.t].apply(u[h],c.o);else if(void 0!==c.na){if("number"!=typeof u[h])throw new Error("Referenced element not a number");u[h]+=c.na}else if(void 0!==c.li&&void 0!==c.ld)r.checkList(u),u[h]=c.li;else if(void 0!==c.li)r.checkList(u),u.splice(h,0,c.li);else if(void 0!==c.ld)r.checkList(u),u.splice(h,1);else if(void 0!==c.lm){if(r.checkList(u),c.lm!=h){var f=u[h];u.splice(h,1),u.splice(c.lm,0,f)}}else if(void 0!==c.oi)r.checkObj(u),u[h]=c.oi;else{if(void 0===c.od)throw new Error("invalid / missing instruction in op");r.checkObj(u),delete u[h]}}return n.data},r.shatter=function(e){for(var t=[],n=0;n<e.length;n++)t.push([e[n]]);return t},r.incrementalApply=function(e,t,n){for(var i=0;i<t.length;i++){var o=[t[i]];n(o,e=r.apply(e,o))}return e};var l=r.pathMatches=function(e,t,n){if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i]&&(!n||i!==e.length-1))return!1;return!0};r.append=function(e,t){if(t=o(t),0!==e.length){var n=e[e.length-1];if(null==t.si&&null==t.sd||null==n.si&&null==n.sd||(a(t),a(n)),l(t.p,n.p))if(t.t&&n.t&&t.t===n.t&&s[t.t]){if(n.o=s[t.t].compose(n.o,t.o),null!=t.si||null!=t.sd){for(var i=t.p,r=0;r<n.o.length-1;r++)t.o=[n.o.pop()],t.p=i.slice(),c(t),e.push(t);c(n)}}else null!=n.na&&null!=t.na?e[e.length-1]={p:n.p,na:n.na+t.na}:void 0!==n.li&&void 0===t.li&&t.ld===n.li?void 0!==n.ld?delete n.li:e.pop():void 0!==n.od&&void 0===n.oi&&void 0!==t.oi&&void 0===t.od?n.oi=t.oi:void 0!==n.oi&&void 0!==t.od?void 0!==t.oi?n.oi=t.oi:void 0!==n.od?delete n.oi:e.pop():void 0!==t.lm&&t.p[t.p.length-1]===t.lm||e.push(t);else null==t.si&&null==t.sd||null==n.si&&null==n.sd||(c(t),c(n)),e.push(t)}else e.push(t)},r.compose=function(e,t){r.checkValidOp(e),r.checkValidOp(t);for(var n=o(e),i=0;i<t.length;i++)r.append(n,t[i]);return n},r.normalize=function(e){var t=[];e=i(e)?e:[e];for(var n=0;n<e.length;n++){var o=e[n];null==o.p&&(o.p=[]),r.append(t,o)}return t},r.commonLengthForOps=function(e,t){var n=e.p.length,i=t.p.length;if((null!=e.na||e.t)&&n++,(null!=t.na||t.t)&&i++,0===n)return-1;if(0===i)return null;n--,i--;for(var o=0;o<n;o++){var r=e.p[o];if(o>=i||r!==t.p[o])return null}return n},r.canOpAffectPath=function(e,t){return null!=r.commonLengthForOps({p:t},e)},r.transformComponent=function(e,t,n,l){t=o(t);var u=r.commonLengthForOps(n,t),h=r.commonLengthForOps(t,n),p=t.p.length,d=n.p.length;if((null!=t.na||t.t)&&p++,(null!=n.na||n.t)&&d++,null!=h&&d>p&&t.p[h]==n.p[h])if(void 0!==t.ld)(v=o(n)).p=v.p.slice(p),t.ld=r.apply(o(t.ld),[v]);else if(void 0!==t.od){(v=o(n)).p=v.p.slice(p),t.od=r.apply(o(t.od),[v])}if(null!=u){var f=p==d,v=n;if(null==t.si&&null==t.sd||null==n.si&&null==n.sd||(a(t),a(v=o(n))),v.t&&s[v.t]){if(t.t&&t.t===v.t){var g=s[t.t].transform(t.o,v.o,l);if(null!=t.si||null!=t.sd)for(var y=t.p,m=0;m<g.length;m++)t.o=[g[m]],t.p=y.slice(),c(t),r.append(e,t);else(!i(g)||g.length>0)&&(t.o=g,r.append(e,t));return e}}else if(void 0!==n.na);else if(void 0!==n.li&&void 0!==n.ld){if(n.p[u]===t.p[u]){if(!f)return e;if(void 0!==t.ld){if(void 0===t.li||"left"!==l)return e;t.ld=o(n.li)}}}else if(void 0!==n.li)void 0!==t.li&&void 0===t.ld&&f&&t.p[u]===n.p[u]?"right"===l&&t.p[u]++:n.p[u]<=t.p[u]&&t.p[u]++,void 0!==t.lm&&f&&n.p[u]<=t.lm&&t.lm++;else if(void 0!==n.ld){if(void 0!==t.lm&&f){if(n.p[u]===t.p[u])return e;y=n.p[u];var b=t.p[u];(y<(_=t.lm)||y===_&&b<_)&&t.lm--}if(n.p[u]<t.p[u])t.p[u]--;else if(n.p[u]===t.p[u]){if(d<p)return e;if(void 0!==t.ld){if(void 0===t.li)return e;delete t.ld}}}else if(void 0!==n.lm)if(void 0!==t.lm&&p===d){b=t.p[u];var _=t.lm,w=n.p[u],O=n.lm;if(w!==O)if(b===w){if("left"!==l)return e;t.p[u]=O,b===_&&(t.lm=O)}else b>w&&t.p[u]--,b>O?t.p[u]++:b===O&&w>O&&(t.p[u]++,b===_&&t.lm++),_>w?t.lm--:_===w&&_>b&&t.lm--,_>O?t.lm++:_===O&&(O>w&&_>b||O<w&&_<b?"right"===l&&t.lm++:_>b?t.lm++:_===w&&t.lm--)}else if(void 0!==t.li&&void 0===t.ld&&f){b=n.p[u],_=n.lm;(y=t.p[u])>b&&t.p[u]--,y>_&&t.p[u]++}else{b=n.p[u],_=n.lm;(y=t.p[u])===b?t.p[u]=_:(y>b&&t.p[u]--,y>_?t.p[u]++:y===_&&b>_&&t.p[u]++)}else if(void 0!==n.oi&&void 0!==n.od){if(t.p[u]===n.p[u]){if(void 0===t.oi||!f)return e;if("right"===l)return e;t.od=n.oi}}else if(void 0!==n.oi){if(void 0!==t.oi&&t.p[u]===n.p[u]){if("left"!==l)return e;r.append(e,{p:t.p,od:n.oi})}}else if(void 0!==n.od&&t.p[u]==n.p[u]){if(!f)return e;if(void 0===t.oi)return e;delete t.od}}return r.append(e,t),e},n(2638)(r,r.transformComponent,r.checkValidOp,r.append);var u=n(2686);r.registerSubtype(u),e.exports=r},2686:function(e,t,n){var i=e.exports={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(e){if(null!=e&&"string"!=typeof e)throw new Error("Initial data must be a string");return e||""}},o=function(e,t,n){return e.slice(0,t)+n+e.slice(t)},r=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");if("string"==typeof e.i==("string"==typeof e.d))throw new Error("component needs an i or d field");if(e.p<0)throw new Error("position cannot be negative")},s=function(e){for(var t=0;t<e.length;t++)r(e[t])};i.apply=function(e,t){var n;s(t);for(var i=0;i<t.length;i++){var r=t[i];if(null!=r.i)e=o(e,r.p,r.i);else{if(n=e.slice(r.p,r.p+r.d.length),r.d!==n)throw new Error("Delete component '"+r.d+"' does not match deleted text '"+n+"'");e=e.slice(0,r.p)+e.slice(r.p+r.d.length)}}return e};var a=i._append=function(e,t){if(""!==t.i&&""!==t.d)if(0===e.length)e.push(t);else{var n=e[e.length-1];null!=n.i&&null!=t.i&&n.p<=t.p&&t.p<=n.p+n.i.length?e[e.length-1]={i:o(n.i,t.p-n.p,t.i),p:n.p}:null!=n.d&&null!=t.d&&t.p<=n.p&&n.p<=t.p+t.d.length?e[e.length-1]={d:o(t.d,n.p-t.p,n.d),p:t.p}:e.push(t)}};i.compose=function(e,t){s(e),s(t);for(var n=e.slice(),i=0;i<t.length;i++)a(n,t[i]);return n},i.normalize=function(e){var t=[];null==e.i&&null==e.p||(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];null==i.p&&(i.p=0),a(t,i)}return t};var c=function(e,t,n){return null!=t.i?t.p<e||t.p===e&&n?e+t.i.length:e:e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length};i.transformCursor=function(e,t,n){for(var i="right"===n,o=0;o<t.length;o++)e=c(e,t[o],i);return e};var l=i._tc=function(e,t,n,i){if(r(t),r(n),null!=t.i)a(e,{i:t.i,p:c(t.p,n,"right"===i)});else if(null!=n.i){var o=t.d;t.p<n.p&&(a(e,{d:o.slice(0,n.p-t.p),p:t.p}),o=o.slice(n.p-t.p)),""!==o&&a(e,{d:o,p:t.p+n.i.length})}else if(t.p>=n.p+n.d.length)a(e,{d:t.d,p:t.p-n.d.length});else if(t.p+t.d.length<=n.p)a(e,t);else{var s={d:"",p:t.p};t.p<n.p&&(s.d=t.d.slice(0,n.p-t.p)),t.p+t.d.length>n.p+n.d.length&&(s.d+=t.d.slice(n.p+n.d.length-t.p));var l=Math.max(t.p,n.p),u=Math.min(t.p+t.d.length,n.p+n.d.length);if(t.d.slice(l-t.p,u-t.p)!==n.d.slice(l-n.p,u-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==s.d&&(s.p=c(s.p,n),a(e,s))}return e};i.invert=function(e){e=e.slice().reverse();for(var t=0;t<e.length;t++)e[t]=null!=(n=e[t]).i?{d:n.i,p:n.p}:{i:n.d,p:n.p};var n;return e},n(2638)(i,l,s,a)},2687:function(e,t){t.doNothing=function(){},t.hasKeys=function(e){for(var t in e)return!0;return!1}},2735:function(e,t,n){"use strict";n.r(t);var i=n(2681),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function r(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}var c=function(){return function(e,t){this.target=t,this.type=e}}(),l=function(e){function t(t,n){var i=e.call(this,"error",n)||this;return i.message=t.message,i.error=t,i}return r(t,e),t}(c),u=function(e){function t(t,n,i){void 0===t&&(t=1e3),void 0===n&&(n="");var o=e.call(this,"close",i)||this;return o.wasClean=!0,o.code=t,o.reason=n,o}return r(t,e),t}(c),h=function(){if("undefined"!=typeof WebSocket)return WebSocket},p={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1},d=function(){function e(e,t,n){void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.eventToHandler=new Map([["open",this._handleOpen.bind(this)],["close",this._handleClose.bind(this)],["error",this._handleError.bind(this)],["message",this._handleMessage.bind(this)]]),this.onclose=void 0,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this._url=e,this._protocols=t,this._options=n,this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce(function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e},0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED||this._connect(),this._disconnect(e,t),this._connect()},e.prototype.send=function(e){this._ws&&this._ws.readyState===this.OPEN?(this._debug("send",e),this._ws.send(e)):(this._debug("enqueue",e),this._messageQueue.push(e))},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(e){return e!==t}))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=0;if(this._retryCount>0){var t=this._options,n=t.reconnectionDelayGrowFactor,i=void 0===n?p.reconnectionDelayGrowFactor:n,o=t.minReconnectionDelay,r=void 0===o?p.minReconnectionDelay:o,s=t.maxReconnectionDelay,a=void 0===s?p.maxReconnectionDelay:s;(e=r*Math.pow(i,this._retryCount-1))>a&&(e=a)}return this._debug("next delay",e),e},e.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},e.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){var t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,i=void 0===n?p.maxRetries:n,o=t.connectionTimeout,r=void 0===o?p.connectionTimeout:o,s=t.WebSocket,a=void 0===s?h():s;if(this._retryCount>=i)this._debug("max retries reached",this._retryCount,">=",i);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),"function"!=typeof(c=a)||2!==c.CLOSING)throw Error("No valid WebSocket class provided");var c;this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new a(t,e._protocols):new a(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},r))})}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new l(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),clearTimeout(this._connectTimeout),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new u(e,t,this))}catch(e){}}},e.prototype._acceptOpen=function(){this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._handleOpen=function(e){var t=this;this._debug("open event");var n=this._options.minUptime,i=void 0===n?p.minUptime:n;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(function(){return t._acceptOpen()},i),this._debug("assign binary type"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(function(e){return t._ws.send(e)}),this._messageQueue=[],this.onopen&&this.onopen(e),this._listeners.open.forEach(function(n){return t._callEventListener(e,n)})},e.prototype._handleMessage=function(e){var t=this;this._debug("message event"),this.onmessage&&this.onmessage(e),this._listeners.message.forEach(function(n){return t._callEventListener(e,n)})},e.prototype._handleError=function(e){var t=this;this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this.onerror&&this.onerror(e),this._debug("exec error listeners"),this._listeners.error.forEach(function(n){return t._callEventListener(e,n)}),this._connect()},e.prototype._handleClose=function(e){var t=this;this._debug("close event"),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(e),this._listeners.close.forEach(function(n){return t._callEventListener(e,n)})},e.prototype._removeListeners=function(){var e,t;if(this._ws){this._debug("removeListeners");try{for(var n=s(this.eventToHandler),i=n.next();!i.done;i=n.next()){var o=a(i.value,2),r=o[0],c=o[1];this._ws.removeEventListener(r,c)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}},e.prototype._addListeners=function(){var e,t;this._debug("addListeners");try{for(var n=s(this.eventToHandler),i=n.next();!i.done;i=n.next()){var o=a(i.value,2),r=o[0],c=o[1];this._ws.addEventListener(r,c)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e}(),f=n(1269),v=n.n(f),g=n(875),y=n.n(g),m=n(1126);function b(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){O(e,t,n[t])})}return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"MonacoAdapter",function(){return E});var S=5;function C(e,t){var n=e.getLinesContent(),i=e.getEOL(),o=0,r=t;for(o=0;o<n.length;++o){var s=n[o];if(r<=s.length)break;r-=s.length+i.length}return{row:o+1,column:r+1}}var E=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.connect=function(e){var t="token=".concat(encodeURIComponent(o.token),"&docId=").concat(encodeURIComponent(e)),n="wss://multi.repl.it/?".concat(t);o.socket=new d(n,[],{maxRetries:S});var r=new i.Connection(o.socket);o.socket.addEventListener("close",o.onSocketClose),o.doc=r.get("workspace",e),o.doc.subscribe(),o.doc.on("op",function(e,t){t||(o.ignore=!0,o.applyOperations(e),o.ignore=!1)}),o.doc.on("load",function(){if(o.ignore=!0,!(o.doc.data&&o.doc.data.files&&o.doc.data.cursors&&o.doc.data.users&&o.doc.data.editorPreferences))throw new Error("Expected doc to load with data from server got "+JSON.stringify(o.doc.data));o.initMonacoListeners(),o.initFiles(),o.initCursors(),o.initUsers(),o.initPreferences(),o.ignore=!1,o.onDocLoaded()}),o.doc.on("del",function(){o.onSessionTerminated(),o.disconnect()})},this.disconnect=function(){o.doc=void 0,o.closeSocket(),o.cleanupMonacoListeners(),o.clearUsersAndCursors(),o.onDisconnect()},this.onSocketClose=function(e){var t=e.reason;Object.values(y.a).includes(t)?(o.disconnect(),o.setConnectionError(t)):o.socket.retryCount>=S&&o.disconnect()},this.closeSocket=function(){o.socket&&(o.socket.removeEventListener("close",o.onSocketClose),o.socket.close(),o.socket=void 0)},this.clearUsersAndCursors=function(){for(var e=Object.keys(o.cursorDecoration),t=0;t<e.length;t++){for(var n=e[t],i=Object.keys(o.cursorDecoration[n]),r=0;r<i.length;r++){var s=i[r];if(o.cursorDecoration[n][s]){var a=window.monaco.Uri.from({scheme:"file",path:s}),c=window.monaco.editor.getModel(a);c.deltaDecorations(o.cursorDecoration[n][s].fadingNameTag,[]),c.deltaDecorations(o.cursorDecoration[n][s].cursor,[])}}o.dropUser(n)}o.cursorDecoration={}},this.setEditor=function(e){o.editorInstance=e,o.cleanupMonacoListeners(),o.initMonacoListeners()},this.cleanupMonacoListeners=function(){o.monacoListeners.forEach(function(e){e&&e.dispose()}),o.monacoListeners=[]},this.initMonacoListeners=function(){o.monacoListeners.push(o.editorInstance.onDidChangeModelContent(o.onChange.bind(o)),o.editorInstance.onDidChangeCursorPosition(o.onCursorActivity.bind(o)))},this.initFiles=function(){if(o.doc){var e=o.doc.data,t=Object.keys(e.files);if(t.length)for(var n=0;n<t.length;n++){var i=t[n],r=P(i),s=window.monaco.editor.getModel("file://".concat(r)),a=e.files[i];s?s.getValue()!==a&&o.dispatchFileChange(r,a):o.dispatchNewFile(r,a)}else{var c=o.getFiles(),l=!0,u=!1,h=void 0;try{for(var p,d=c[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){var f=p.value;o.onNewFile(w({},f,{noIgnore:!0}))}}catch(e){u=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}}}},this.initCursors=function(){if(o.doc)for(var e=o.doc.data,t=Object.keys(e.cursors),n=0;n<t.length;n++){var i=t[n];if(i!==o.username){var r={p:["cursors",i],oi:e.cursors[i]};o.newCursor(r),o.drawCursor(r)}}},this.initUsers=function(){if(o.doc)for(var e=o.doc.data,t=Object.keys(e.users),n=0;n<t.length;n++){var i=t[n];o.addUser(i,e.users[i])}},this.initPreferences=function(){var e=o.doc;if(e){var t=e.data;if(Object.keys(t.editorPreferences).length){var n=t.editorPreferences,i=n.tabSize,r=n.insertSpaces;o.updatePreferences({tabSize:i,insertSpaces:r})}else{if(!o.isOwner())throw new Error("Preferences should've been set by owner");var s=o.getPreferences();e.submitOp({p:["editorPreferences"],oi:s})}}},this.onChange=function(e){if(o.doc&&!o.ignore){o.ignore=!0;var t=!0,n=!1,i=void 0;try{for(var r,s=e.changes[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var a=r.value;o.submitChange(o.editorInstance.getModel(),a)}}catch(e){n=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}o.ignore=!1}},this.onCursorActivity=function(){o.userToFollow&&!o.settingOwnPosition&&(o.userToFollow=null,o.unfollowUserCursor()),o.settingOwnPosition=!1;var e=o.editorInstance.getSelections().map(function(e){return{filePath:o.editorInstance.getModel().uri.path,cursorLine:e.positionLineNumber,cursorColumn:e.positionColumn,selectionStartLine:e.startLineNumber,selectionStartColumn:e.startColumn,selectionEndLine:e.endLineNumber,selectionEndColumn:e.endColumn}});if(o.doc&&o.username&&!o.ignore&&!o.doc.data.users[o.username].isGod){var t={p:["cursors",o.username],oi:e};o.doc.data.cursors[o.username]&&(t.od=o.doc.data.cursors[o.username]),o.doc.submitOp(t)}},this.onOptionsChange=function(e){var t=e.tabSize,n=e.insertSpaces,i=o.doc;i&&o.isOwner()&&i.submitOp({p:["editorPreferences"],oi:{tabSize:t,insertSpaces:n},od:i.data.editorPreferences})},this.onNewFile=function(e){var t=e.path,n=e.value,i=e.noIgnore,r=x(t);!o.doc||o.ignore&&!i||o.doc.submitOp({p:["files",r],oi:n})},this.onDeleteFile=function(e){var t=x(e.path);o.doc&&!o.ignore&&o.doc.submitOp({p:["files",t],od:o.doc.data.files[t]})},this.onMoveFile=function(e){var t=e.from,n=e.to,i=o.doc;if(i){var r=i.data.files[x(t)];o.onNewFile({path:n,value:r}),o.onDeleteFile({path:t})}},this.submitChange=function(e,t){var n=x(e.uri.path);if(o.doc&&o.doc.data){var i=o.doc.data.files[n];if("string"!=typeof i)o.doc.submitOp({p:["files",n],oi:e.getValue()});else{var r=t.rangeOffset;t.rangeLength>0&&o.doc.submitOp({p:["files",n,r],sd:i.substr(r,t.rangeLength)}),t.text&&o.doc.submitOp({p:["files",n,r],si:t.text})}}},this.applyOperations=function(e){var t=new Set,n=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var c=s.value,l=c.p[0];switch(l){case"files":var u=o.applyFileChanges(c);u&&t.add(u);break;case"cursors":o.applyCursorChanges(c);break;case"users":o.applyUserChanges(c);break;case"editorPreferences":o.applyPreferencesChanges(c);break;case"bannedUsers":break;default:throw new Error("Unknown operation type "+l)}}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}if(o.doc){var h=o.doc.data,p=!0,d=!1,f=void 0;try{for(var v,g=t[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var y=v.value,m=window.monaco.Uri.parse("file://".concat(y)),b=window.monaco.editor.getModel(m),_=h.files[x(y)];b.getValue()!==_&&b.setValue(_)}}catch(e){d=!0,f=e}finally{try{p||null==g.return||g.return()}finally{if(d)throw f}}}},this.applyFileChanges=function(e){var t=_(e.p,3),n=t[1],i=t[2],r=P(n);if(void 0===e.od)if(void 0===e.oi){if(void 0!==i){var s=window.monaco.Uri.parse("file://".concat(r)),a=window.monaco.editor.getModel(s),c=[],l=C(a,i),u=!1;if(void 0!==e.si){var h=l,p=new window.monaco.Range(l.row,l.column,h.row,h.column);c.push({range:p,text:e.si,forceMoveMarkers:!0}),a===o.editorInstance.getModel()&&o.editorInstance.getPosition().equals({column:l.column,lineNumber:l.row})&&(u=!0)}if(void 0!==e.sd){var d=C(a,i+e.sd.length),f=new window.monaco.Range(l.row,l.column,d.row,d.column);c.push({range:f,text:"",forceMoveMarkers:!0})}return a.applyEdits(c),u&&o.setCursorPosition({column:l.column,lineNumber:l.row}),r}}else o.dispatchNewFile(r,e.oi);else o.dispatchDeleteFile(r)},this.applyCursorChanges=function(e){e.oi&&!e.od?(o.newCursor(e),o.drawCursor(e)):e.oi?(o.deleteCursor(e),o.drawCursor(e)):e.od&&o.deleteCursor(e)},this.newCursor=function(e){var t=_(e.p,2)[1];o.username!==t&&(o.cursorDecoration[t]={})},this.drawCursor=function(e){var t=_(e.p,2)[1];if(o.username!==t&&e.oi){var n={},i=o.doc;if(i){var r=!0,s=!1,a=void 0;try{for(var c,l=e.oi[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var u=c.value,h=u.filePath,p=u.cursorLine,d=u.cursorColumn,f=u.selectionStartLine,v=u.selectionStartColumn,g=u.selectionEndLine,y=u.selectionEndColumn;i.data.files[x(h)]&&(n[h]||(n[h]={fadingNameTag:[],cursor:[]}),n[h].fadingNameTag=n[h].fadingNameTag.concat({range:new window.monaco.Range(p,d,p,d),options:{className:"cursor-tag-"+Object(m.a)(t),stickiness:window.monaco.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:t,isTrusted:!1}}}),n[h].cursor=n[h].cursor.concat([{range:new window.monaco.Range(p,d,p,d),options:{className:"cursor-"+Object(m.a)(t),stickiness:window.monaco.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:t,isTrusted:!1}}},{range:new window.monaco.Range(f,v,g,y),options:{className:"selection-"+Object(m.a)(t),stickiness:window.monaco.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore}}]))}}catch(e){s=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(s)throw a}}for(var w=Object.keys(n),O=function(){var e=w[k],i=window.monaco.Uri.from({scheme:"file",path:e}),r=window.monaco.editor.getModel(i);o.cursorDecoration[t][e]||(o.cursorDecoration[t][e]={fadingNameTag:[],cursor:[]}),o.cursorDecoration[t][e].cursor=r.deltaDecorations([],n[e].cursor),o.cursorDecoration[t][e].fadingNameTag=r.deltaDecorations([],n[e].fadingNameTag);var s=b(o.cursorDecoration[t][e].fadingNameTag);setTimeout(function(){r.isDisposed()||r.deltaDecorations(s,[])},2e3)},k=0;k<w.length;k++)O();o.userToFollow===t&&o.gotoUserCursor(t)}}},this.deleteCursor=function(e){var t=_(e.p,2)[1],n=o.cursorDecoration[t];if(e.od&&n&&Object.keys(n).length){var i=!0,r=!1,s=void 0;try{for(var a,c=e.od[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var l=a.value.filePath,u=window.monaco.Uri.from({scheme:"file",path:l}),h=window.monaco.editor.getModel(u);if(!h)return;n[l]&&(h.deltaDecorations(n[l].cursor,[]),h.deltaDecorations(n[l].fadingNameTag,[]),delete o.cursorDecoration[t][l])}}catch(e){r=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(r)throw s}}}},this.applyUserChanges=function(e){if(o.doc){var t=_(e.p,2)[1],n=o.doc.data.users[t];3===e.p.length?o.updateUser(t,O({},e.p[2],e.oi)):e.od?(o.dropUser(t),t===o.userToFollow&&(o.userToFollow=null,o.unfollowUserCursor())):o.addUser(t,n)}},this.applyPreferencesChanges=function(e){o.doc&&o.updatePreferences(e.oi)},this.followUserCursor=function(e){o.setCursorPosition({column:1,lineNumber:1}),o.userToFollow=e,o.gotoUserCursor(e)},this.setCursorPosition=function(e){var t=e.column,n=e.lineNumber;o.settingOwnPosition=!0,o.editorInstance.setPosition({column:t,lineNumber:n})},window.adapter=this,this.ignore=!1,this.editorInstance=t,this.cursorDecoration={},this.monacoListeners=[],this.token=n,this.username=v()(n).username}var t,n,o;return t=e,(n=[{key:"gotoUserCursor",value:function(e){var t=this.cursorDecoration[e];if(t){var n=Object.keys(t)[0];this.switchFile(n);var i=t[n].cursor[0],o=window.monaco.Uri.from({scheme:"file",path:n}),r=window.monaco.editor.getModel(o).getDecorationRange(i),s=r.startLineNumber,a=r.endLineNumber;this.editorInstance.revealLinesInCenter(s,a)}}},{key:"promoteUser",value:function(e){if(this.isAdmin()&&this.doc){var t=this.doc.data.users[e];t.canEdit?t.isAdmin||(this.doc.submitOp({p:["users",e,"isAdmin"],od:!1,oi:!0}),this.updateUser(e,{isAdmin:!0})):(this.doc.submitOp({p:["users",e,"canEdit"],od:!1,oi:!0}),this.updateUser(e,{canEdit:!0}))}}},{key:"demoteUser",value:function(e){if(this.isAdmin()&&this.doc){var t=this.doc.data.users[e];t.isAdmin?(this.doc.submitOp({p:["users",e,"isAdmin"],od:!0,oi:!1}),this.updateUser(e,{isAdmin:!1})):t.canEdit&&(this.doc.submitOp({p:["users",e,"canEdit"],od:!0,oi:!1}),this.updateUser(e,{canEdit:!1}))}}},{key:"banUser",value:function(e){this.isAdmin()&&this.doc&&(this.doc.submitOp({p:["bannedUsers",this.doc.data.bannedUsers.length-1],li:e}),this.dropUser(e))}},{key:"isAdmin",value:function(){if(this.doc){var e=this.doc.data;if(this.username)return e.users[this.username].isAdmin}}},{key:"isOwner",value:function(){if(this.doc){var e=this.doc.data;if(this.username)return e.users[this.username].isOwner}}}])&&k(t.prototype,n),o&&k(t,o),e}();function x(e){return window.btoa(e)}function P(e){return window.atob(e)}}}]);
//# sourceMappingURL=5.43d11eec9cc478855c10.js.map